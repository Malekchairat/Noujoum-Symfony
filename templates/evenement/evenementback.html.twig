{% extends 'backoffice.html.twig' %}

{% block title %}Evenements Management{% endblock %}

{% block body %}
<style>
    .event-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        position: relative;
    }
    .event-card:hover {
        transform: scale(1.02);
        box-shadow: 0 0 15px gold;
    }

    .gold-button, .edit-button, .delete-button {
        transition: all 0.3s ease;
        display: inline-block;
    }

    .gold-button {
        background-color: gold;
        color: black;
        padding: 10px 20px;
        border-radius: 5px;
        font-weight: 600;
        text-decoration: none;
    }

    .gold-button:hover {
        background-color: #ffd700;
        box-shadow: 0 0 10px #ffd700;
        transform: scale(1.05);
    }

    .edit-button {
        border: 1px solid gold;
        color: gold;
        background: transparent;
        border-radius: 5px;
        padding: 5px 10px;
        text-decoration: none;
        margin-right: 5px;
    }

    .edit-button:hover {
        background-color: gold;
        color: black;
        transform: scale(1.05);
        box-shadow: 0 0 8px gold;
    }

    .delete-button {
        background-color: red;
        border: none;
        border-radius: 5px;
        padding: 5px 10px;
        color: white;
        cursor: pointer;
    }

    .delete-button:hover {
        background-color: darkred;
        transform: scale(1.05);
        box-shadow: 0 0 8px red;
    }

    .sold-out-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background: red;
        color: white;
        padding: 5px 8px;
        border-radius: 3px;
        font-weight: bold;
        font-size: 0.9em;
    }

    /* Progress bar styles */
    .progress-bar-container {
        background-color: #4d4d4d;
        border-radius: 10px;
        width: 100%;
        height: 12px;
        margin-top: 8px;
        overflow: hidden;
    }
    .progress-bar {
        height: 100%;
        transition: width 0.4s ease;
    }
    .progress-bar.in-progress {
        background-color: gold;
    }
    .progress-bar.sold-out {
        background-color: green;
    }
    .progress-label {
        margin-top: 4px;
        font-size: 0.85rem;
        color: #ddd;
        text-align: right;
    }
</style>

<div style="background-color: #303234; padding: 40px; border-radius: 10px; margin-top: 50px;">
    <h1 class="text-center" style="margin-bottom: 30px; color: gold;">üé≠ Gestion evenements</h1>

    {# Flash messages #}
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="alert alert-{{ label }}" style="margin-bottom: 20px;">
                {{ message }}
            </div>
        {% endfor %}
    {% endfor %}

    <div class="text-end" style="margin-bottom: 40px;">
        <a href="{{ path('evenement_new') }}" class="gold-button">‚ûï Creer nouveau evenement</a>
        <a href="{{ path('ticket_back') }}" class="gold-button" style="margin-left: 10px;">üé´Voir Tickets</a>
        <a href="{{ path('evenement_stat') }}" class="gold-button" style="margin-left: 10px;">üìä Voir Statistics</a>
        <a href="{{ path('evenement_expired') }}" class="gold-button" style="margin-left: 10px;">‚è≥ √âv√©nements expir√©s</a>
    </div>

    <div style="display: flex; flex-wrap: wrap; gap: 20px; justify-content: center;">
        {% for evenement in evenements %}
            {# calculate sold & percentage #}
            {% set sold = 0 %}
            {% for t in evenement.tickets %}
                {% set sold = sold + t.quantite %}
            {% endfor %}
            {% set percent = maxTickets > 0 ? (sold / maxTickets * 100) : 0 %}

            <div class="event-card" style="width: 350px; background-color: black; border: 2px solid gold; color: white; border-radius: 10px; overflow: hidden; display: flex; flex-direction: column;">
                {# sold-out badge #}
                {% if percent >= 100 %}
                    <div class="sold-out-badge">Sold Out</div>
                {% endif %}

                {# image #}
                {% if evenement.image %}
                    <img src="{{ asset('uploads/' ~ evenement.image) }}" alt="{{ evenement.Titre }}" style="width: 100%; height: 180px; object-fit: cover;">
                {% endif %}

                <div style="padding: 15px;">
                    <h5 style="margin-bottom: 10px; color: gold;">üé´ {{ evenement.Titre }}</h5>
                    <p>üìú <strong>Description:</strong> {{ evenement.Description|slice(0, 100) }}</p>
                    <p>üìÖ <strong>Date:</strong> {{ evenement.dateDebut|date('Y-m-d') }} ‚Üí {{ evenement.dateFin|date('Y-m-d') }}</p>
                    <p>üìç <strong>Lieu:</strong> {{ evenement.Lieu }}</p>
                    <p>üé∂ <strong>Type:</strong> {{ evenement.TypeE }}</p>
                    <p>üé§ <strong>Artiste:</strong> {{ evenement.artiste }}</p>

                    {# Progress bar #}
                    <div class="progress-bar-container">
                        <div class="progress-bar {% if percent >= 100 %}sold-out{% else %}in-progress{% endif %}" style="width: {{ percent }}%"></div>
                    </div>
                    <div class="progress-label">{{ percent|number_format(2) }}%</div>

                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                        <a href="{{ path('evenement_details', {'id': evenement.id}) }}" class="gold-button">D√©tails</a>
                        <div>
                            <a href="{{ path('evenement_edit', {'id': evenement.id}) }}" class="edit-button">Modifier</a>
                            <form method="POST" action="{{ path('evenement_delete', {'id': evenement.id}) }}" onsubmit="return confirm('Are you sure?');" style="display: inline;">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ evenement.id) }}">
                                <button type="submit" class="delete-button">Supprimer</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        {% else %}
            <p class="text-center text-white">No events found.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}
