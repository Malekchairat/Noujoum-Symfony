{% block title %}Statistiques des Promotions{% endblock %}

{% block stylesheets %}
   
    <style>
        .chart-container {
            max-width: 600px;
            margin: 20px auto;
        }
    </style>
{% endblock %}

{% block body %}
<div class="container mt-5">
    <h2 class="fw-bold text-gold"><i class="fas fa-chart-bar me-2"></i> Statistiques des Promotions</h2>

    <!-- Graphique : Nombre de promotions par produit -->
    <div class="chart-container">
        <h4>Nombre de promotions par produit</h4>
        <canvas id="promotionsByProductChart"></canvas>
    </div>

    <!-- Graphique : Pourcentage moyen par produit -->
    <div class="chart-container">
        <h4>Pourcentage moyen par produit</h4>
        <canvas id="averageDiscountChart"></canvas>
    </div>

    <!-- Graphique : Promotions actives vs expirées -->
    <div class="chart-container">
        <h4>Promotions actives vs expirées</h4>
        <canvas id="activeVsExpiredChart"></canvas>
    </div>

    <!-- Graphique : Promotions par catégorie -->
    <div class="chart-container">
        <h4>Promotions par catégorie</h4>
        <canvas id="promotionsByCategoryChart"></canvas>
    </div>
</div>
{% endblock %}

{% block javascripts %}
   
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Promotions par produit
        const promotionsByProductData = {
            labels: [{% for data in promotionsByProduct %}'{{ data.produit }}',{% endfor %}],
            datasets: [{
                label: 'Nombre de promotions',
                data: [{% for data in promotionsByProduct %}{{ data.nombre_promotions }},{% endfor %}],
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        };
        new Chart(document.getElementById('promotionsByProductChart'), {
            type: 'bar',
            data: promotionsByProductData,
            options: { scales: { y: { beginAtZero: true } } }
        });

        // Pourcentage moyen par produit
        const averageDiscountData = {
            labels: [{% for data in averageDiscountByProduct %}'{{ data.produit }}',{% endfor %}],
            datasets: [{
                label: 'Pourcentage moyen (%)',
                data: [{% for data in averageDiscountByProduct %}{{ data.pourcentage_moyen|round(2) }},{% endfor %}],
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
            }]
        };
        new Chart(document.getElementById('averageDiscountChart'), {
            type: 'bar',
            data: averageDiscountData,
            options: { scales: { y: { beginAtZero: true } } }
        });

        // Promotions actives vs expirées
        const activeVsExpiredData = {
            labels: ['Actives', 'Expirées'],
            datasets: [{
                label: 'Promotions',
                data: [{{ activeVsExpired.actives }}, {{ activeVsExpired.expirees }}],
                backgroundColor: ['rgba(54, 162, 235, 0.2)', 'rgba(255, 99, 132, 0.2)'],
                borderColor: ['rgba(54, 162, 235, 1)', 'rgba(255, 99, 132, 1)'],
                borderWidth: 1
            }]
        };
        new Chart(document.getElementById('activeVsExpiredChart'), {
            type: 'pie',
            data: activeVsExpiredData
        });

        // Promotions par catégorie
        const promotionsByCategoryData = {
            labels: [{% for data in promotionsByCategory %}'{{ data.categorie }}',{% endfor %}],
            datasets: [{
                label: 'Nombre de promotions',
                data: [{% for data in promotionsByCategory %}{{ data.nombre_promotions }},{% endfor %}],
                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                borderColor: 'rgba(153, 102, 255, 1)',
                borderWidth: 1
            }]
        };
        new Chart(document.getElementById('promotionsByCategoryChart'), {
            type: 'bar',
            data: promotionsByCategoryData,
            options: { scales: { y: { beginAtZero: true } } }
        });
    </script>
{% endblock %}