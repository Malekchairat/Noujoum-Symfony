{# templates/backoffice/produit/index.html.twig #}
{% extends 'backoffice.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/backoffice.css') }}">
{% endblock %}

{% block title %}Gestion des Produits{% endblock %}

{% block body %}
<style>
    /* Card hover */
    .product-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .product-card:hover {
        transform: scale(1.02);
        box-shadow: 0 0 15px gold;
    }

    /* Gold action buttons */
    .gold-button, .edit-button, .delete-button {
        transition: all 0.3s ease;
        display: inline-block;
        text-decoration: none;
        text-align: center;
    }

    .gold-button {
        background-color: gold;
        color: black;
        padding: 10px 20px;
        border-radius: 5px;
        font-weight: 600;
    }
    .gold-button:hover {
        background-color: #ffd700;
        box-shadow: 0 0 10px #ffd700;
        transform: scale(1.05);
    }

    .edit-button {
        border: 1px solid gold;
        color: gold;
        background: transparent;
        border-radius: 5px;
        padding: 5px 10px;
    }
    .edit-button:hover {
        background-color: gold;
        color: black;
        box-shadow: 0 0 8px gold;
        transform: scale(1.05);
    }

    .delete-button {
        background-color: red;
        border: none;
        border-radius: 5px;
        padding: 5px 10px;
        color: white;
        cursor: pointer;
    }
    .delete-button:hover {
        background-color: darkred;
        box-shadow: 0 0 8px red;
        transform: scale(1.05);
    }

    /* Utility */
    .text-gold { color: gold !important; }
    .cards-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
    }
</style>

<div style="background-color: #303234; padding: 40px; border-radius: 10px; margin-top: 50px;">
    <h1 class="text-center text-gold mb-4">ðŸ“¦ Gestion des Produits</h1>

    {# Flash messages #}
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="alert alert-{{ label }}" style="margin-bottom: 20px;">
                {{ message }}
            </div>
        {% endfor %}
    {% endfor %}

    <div class="text-end mb-4">
        <a href="{{ path('produit_ajout') }}" class="gold-button">
            <i class="fas fa-plus-circle me-2"></i> Ajouter un Produit
        </a>
        <a href="{{ path('app_podium') }}" class="gold-button" style="margin-left:10px;">
            <i class="fas fa-trophy me-2"></i> Produits les Plus Populaires
        </a>
    </div>

    <div class="cards-container">
        {% for produit in produits %}
            <div class="product-card" style="
                    width: 320px;
                    background-color: black;
                    border: 2px solid gold;
                    border-radius: 10px;
                    overflow: hidden;
                    display: flex;
                    flex-direction: column;
                    color: white;
                ">
                {% if produit.imageName %}
                    <img src="{{ asset('uploads/' ~ produit.imageName) }}"
                         alt="{{ produit.nom }}"
                         style="width:100%; height:180px; object-fit:cover;">
                {% endif %}
                <div style="padding: 15px; flex:1; display:flex; flex-direction:column;">
                    <h5 class="text-gold mb-2">ðŸ“¦ {{ produit.nom }}</h5>
                    <p style="flex:1;">
                        {{ produit.description|length > 60
                            ? produit.description[:60] ~ '...'
                            : produit.description
                        }}
                    </p>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="badge bg-secondary">{{ produit.categorie }}</span>
                        <span class="fw-bold">{{ produit.prix }}â‚¬</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <a href="{{ path('produit_edit', {'id': produit.id}) }}"
                           class="edit-button">
                            <i class="fas fa-edit me-1"></i> Modifier
                        </a>
                        <form method="POST"
                              action="{{ path('produit_delete', {'id': produit.id}) }}"
                              onsubmit="return confirm('ÃŠtes-vous sÃ»r ?');"
                              style="display:inline;">
                            <input type="hidden" name="_token"
                                   value="{{ csrf_token('delete' ~ produit.id) }}">
                            <button type="submit" class="delete-button">
                                <i class="fas fa-trash-alt me-1"></i> Supprimer
                            </button>
                        </form>
                    </div>
                    <div class="d-flex justify-content-between mt-2">
                        <a href="{{ path('promotion_add', {'produitId': produit.id}) }}"
                           class="edit-button">
                            <i class="fas fa-plus-circle me-1"></i> Promo
                        </a>
                        <a href="{{ path('produit_promotions', {'id': produit.id}) }}"
                           class="edit-button">
                            <i class="fas fa-tags me-1"></i> Voir promos
                        </a>
                    </div>
                </div>
            </div>
        {% else %}
            <p class="text-center text-white">Aucun produit trouvÃ©.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}
