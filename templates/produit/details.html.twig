{% extends 'base.html.twig' %}

{% block title %}{{ produit.nom }} - D√©tails{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .spotify-player {
            background-color: #282828;
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
        }
        .spotify-player iframe {
            border-radius: 8px;
            width: 100%;
        }
            .product-image {
           
            object-fit: cover;
        }
        .product-info {
            padding-left: 30px;
        }
    </style>
{% endblock %}

{% block body %}
<div class="container mt-4 bg-dark text-light p-4 rounded">
    <div class="row">
        <div class="col-md-6">
            <img src="{{ asset('uploads/' ~ produit.imageName) }}" alt="{{ produit.nom }}" class="img-fluid mb-3 rounded">
        </div>
        <div class="col-md-6">
            <h2>
                {{ produit.nom }}
                <!-- üíñ Heart form button -->
                <button class="btn btn-link p-0 border-0" onclick="toggleFavori(event, {{ produit.id }})" title="Ajouter aux favoris">
                    <i id="heart-{{ produit.id }}" class="fa{{ favoris ? 's' : 'r' }} fa-heart text-danger fs-4"></i>
                </button>
            </h2>

            <p><strong>Cat√©gorie :</strong> {{ produit.categorie }}</p>
            <p><strong>Description :</strong> {{ produit.description }}</p>

            {% if produit.getPrixPromo() %}
                <p><del>{{ produit.prix }}‚Ç¨</del> <strong class="text-danger">{{ produit.getPrixPromo() }}‚Ç¨</strong></p>
                {% if promo %}
                    <span class="badge bg-danger">-{{ promo.pourcentage }}% jusqu'au {{ promo.expiration|date('d/m/Y') }}</span>
                {% endif %}
            {% else %}
                <p><strong>{{ produit.prix }}‚Ç¨</strong></p>
            {% endif %}

            {% if produit.disponibilite < 5 %}
                <p class="text-warning">‚ö†Ô∏è Plus que {{ produit.disponibilite }} en stock !</p>
            {% else %}
                <p class="text-success">En stock : {{ produit.disponibilite }}</p>
            {% endif %}

            <a href="#" class="btn btn-success mt-3">Acheter</a>

            <!-- Int√©gration Spotify -->
            {% if spotifyEmbedUrl %}
                <div class="spotify-player mt-4">
                    <iframe src="{{ spotifyEmbedUrl }}"
                            height="380"
                            frameborder="0"
                            allowtransparency="true"
                            allow="encrypted-media"
                            style="width: 100%;">
                    </iframe>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
<script>
    function toggleFavori(event, produitId) {
        event.preventDefault();
        const heartIcon = document.getElementById('heart-' + produitId);

        heartIcon.classList.add('animate-heart');
        setTimeout(() => {
            heartIcon.classList.remove('animate-heart');
        }, 500);

        fetch('/favoris/toggle/' + produitId, {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                if (data.action === 'added') {
                    heartIcon.classList.remove('far');
                    heartIcon.classList.add('fas');
                } else {
                    heartIcon.classList.remove('fas');
                    heartIcon.classList.add('far');
                }
            } else {
                console.error('Erreur:', data.message);
            }
        })
        .catch(error => console.error('Erreur fetch:', error));
    }
</script>

<style>
    .animate-heart {
        animation: bounce 0.5s ease-in-out;
    }

    @keyframes bounce {
        0% { transform: scale(1); }
        30% { transform: scale(1.2); }
        50% { transform: scale(1); }
    }
</style>
{% endblock %}
